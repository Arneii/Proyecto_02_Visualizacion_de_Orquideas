---
title: "Proyecto_02_Visualizacion_de_Orquideas. Sara Alvarado Siles"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
---

```{r carga-paquetes, message=FALSE, warning=FALSE}
# Carga de paquetes
library(sf)
library(DT)
library(dplyr)
library(leafem) 
library(raster)
library(plotly)
library(leaflet)
library(flexdashboard)
library(leaflet.extras)
```


```{r carga_datos, message=FALSE, warning=FALSE}
# Carga de la capa de orquídeas (familia Orchidaceae)
orquideas <-
  st_read(
    "https://raw.githubusercontent.com/gf0604-procesamientodatosgeograficos/2021i-datos/main/gbif/orchidaceae-cr-registros.csv",
    options = c(
      "X_POSSIBLE_NAMES=decimalLongitude",
      "Y_POSSIBLE_NAMES=decimalLatitude"
    ),
    quiet = TRUE
  )

# Asignación del sistema de coordenadas
st_crs(orquideas) <- 4326


# Carga de la capa de cantones
cantones <-
  st_read(
    "https://raw.githubusercontent.com/gf0604-procesamientodatosgeograficos/2021i-datos/main/ign/delimitacion-territorial-administrativa/cr_cantones_simp_wgs84.geojson",
    quiet = TRUE
  )

# Carga de la capa de provincias
provincias <-
  st_read(
    "https://raw.githubusercontent.com/gf0604-procesamientodatosgeograficos/2021i-datos/main/ign/delimitacion-territorial-administrativa/cr_provincias_simp_wgs84.geojson",
    quiet = TRUE
  )
```

```{r limpieza, message=FALSE, warning=FALSE}
# Cruce espacial con la tabla de provincias y cantones
orquideas <- 
  orquideas %>%
  st_join(cantones["provincia"]) %>%
  st_join(cantones["canton"])


# Descartar registros con alta incertidumbre 
orquideas <- 
  orquideas %>%
  filter(coordinateUncertaintyInMeters <= 1000) %>%
  mutate(eventDate = as.Date(eventDate, "%Y-%m-%d"))
```

```{r prueba}
# Eliminar vacios y NA
orquideas <-
  orquideas %>%
  filter(!is.na(species) & species != "") 
```

```{r prueba2, message=FALSE, warning=FALSE}
orquideas_especies <- 
  orquideas %>% 
  group_by(species) %>% 
  summarize(n_especies = n())
```

```{r prueba3, message=FALSE, warning=FALSE}
orquideas_generos <- 
  orquideas %>% 
  group_by(genus) %>% 
  summarize(n_generos = n())
```

Registros de presencia
======================================================================

Row {data-height=200}
-----------------------------------------------------------------------

### Cantidad total de registros de presencia {.value-box}
```{r}
valueBox(value = nrow(orquideas),
         caption = "Cantidad total de registros de presencia",
         icon = "fas fa-feather=alt",
         color = "blue")
```

### Cantidad total de géneros {.value-box}
```{r}
valueBox(value = nrow(orquideas_generos),
         caption = "Cantidad total de géneros",
         icon = "fas fa-feather=alt",
         color = "blue")
```

### Cantidad total de especies {.value-box}
```{r}
valueBox(value = nrow(orquideas_especies),
         caption = "Cantidad total de especies",
         icon = "fas fa-feather=alt",
         color = "blue")
```

Row {data-height=800}
-----------------------------------------------------------------------

### Chart A

```{r tabla_registros, message=FALSE, warning=FALSE}
# Tabla de registros de presencia
orquideas %>%
  st_drop_geometry() %>%
  dplyr::select(species, stateProvince, canton, eventDate) %>%
  datatable(
    colnames = c(
      "Especie",
      "Provincia",
      "Canton",
      "Fecha"
    ),
    options = list(searchHighlight = TRUE, language = list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json')
    )
  )
```

### Chart B

```{r}

```



